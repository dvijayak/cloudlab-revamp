 <!DOCTYPE html
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" id="viewport" content="height=device-height,width=device-width,user-scalable=no" />
		<title>Cloud Lab: View Projects</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>		
	</head>
	
	<body>						
		<script>
			$(document).ready(function () {
				// Ensure that the user is logged in				
				var url = "http://localhost/cloudlab_revamp/php/main.php",
					//data = "course=" + document.URL.split("=")[1] + "&getProjects=true",
					data = document.URL.split("?")[1] + "&getProjects=true",
					success = function (data) {						
						var output = $.parseJSON(data);						
						if (output.status == "OK") {							
							$( "#header_username" ).text(output.data.firstname);
							
							// Hide toolbar if Student
							if (output.data.role != "2") {
								$( "#projects_toolbar" ).hide();
							}
							
							// Generate list of projects for the chosen course
							var projects = output.data.projects;
							var nProjects = projects.length;
							for (var i = 0; i < nProjects; i++) {								
								/* Note: by passing a data map to the click handler, we preserve the value of projects[i].
								 * Otherwise, projects[i] would take the value of undefined
								 */								
								$( "<li><a href='#'>" + projects[i].toUpperCase() + "</a></li>").click({project: projects[i]}, function (event) {
									window.location.href = "editor.html?course=" + output.data.course + "&project=" + event.data.project;
								}).appendTo( "#projects_listOfProjects" );
							}							
						}
						// Incorrect login credentials
						else if (output.status == "INTRUDER") {
							alert("Back off, intruder!");
							window.location.href = "index.html";							
						}
					},
					dataType = "text";						
				$.post(url, data, success, dataType);				
			});
		</script>
		
		<div id="header">
			<script>
				$(function () {
					$( "#header button" ).click(function () {
						var url = "http://localhost/cloudlab_revamp/php/main.php",
							data = "logout=true",
							success = function (data) {
								var output = $.parseJSON(data);
								if (output.status == "LOGOUT") {									
									window.location.href = "index.html";
								}
							},
							dataType = "text";						
						$.post(url, data, success, dataType);
					});
					
					$( "#backButton" ).click(function () {
						window.location.href=document.referrer;
					});
					
					$( "#header_title" ).text(document.URL.split("=")[1].toUpperCase() + ": Choose Project");
				});
			</script>			
			<button id="backButton">Back</button> <!-- TODO: Add a back arrow image -->
			<span id="header_title"></span>
			<span id="header_username"></span>	
			<!--<a>Logout</a>				-->
			<button>Logout</button>			
		</div>
				
		<!-- Only viewable by instructors -->
		<ul id="projects_toolbar">
			<script>
				$(function () {
					//$( "#projects_toolbar" ).menu();
				});
			</script>
			<li><a href="">New</a></li>
			<li><a href="">Edit</a></li>
			<li><a href="">Delete</a></li>
			<li><a href="">Upload</a></li>
			<li><a href="">Distribute</a></li>
		</ul>		
		
		<!-- TODO: fieldset is a temporary solution -->
		<fieldset>
			<legend>Go To Project</legend>
			<div id="project_browser">
				<!-- List of projects is dynamically populated via AWS RDS -->
				<ul id="projects_listOfProjects">
					<!--<li><a href="">A1</a></li>-->
					<!--<li><a href="">A2</a></li>-->
					<!--<li><a href="">A3</a></li>-->
				</ul>
			</div>
		</fieldset>
		
		<!-- When a project is selected, generate the project description in HTML from various input sources: .md, .ps, .tex, etc.-->
		<div id="project_preview">
			<fieldset>
				<legend>Project Preview</legend>
				<iframe></iframe>
			</fieldset>
		</div>
		
	</body>	
</html>

